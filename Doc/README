!
! Copyright (C) 2013 - 2014 Andrea Dal Corso
! This file is distributed under the terms of the
! GNU General Public License. See the file `License'
! in the root directory of the present distribution,
! or http://www.gnu.org/copyleft/gpl.txt .
!

Thermo_pw is a fortran driver for the calculation of thermodynamic quantities,
using the harmonic and/or the quasiharmonic approximation and the plane waves 
pseudopotential method. At low level it uses the QE routines to perform the 
calculations. Thermo_pw reads the input of pw.x, the input of ph.x
and a file called thermo_control that specifies which calculations to do 
and the parameters that control these calculations. If there are several 
available images the different tasks are carried out in parallel when 
possible. The type of tasks currently implemented in thermo_pw are:

1) Computation of the total energy.
2) Total energy as a function of the kinetic energy cut-off.
3) Total energy as a function of k points and smearing.
4) Band structure calculation at fixed geometry.
5) Phonon frequencies at one q at fixed geometry.
6) Phonon dispersions at fixed geometry and computation of the harmonic
   thermodynamical properties: vibrational energy, vibrational free energy,
   vibrational entropy, constant volume molar heat capacity.
7) Murnaghan fit of the total energy as function of the lattice parameter.
8) Band structure at the Murnaghan minimum.
9) Phonon frequencies at one q at the Murnaghan minimum.
10) Phonon dispersions and harmonic vibrational thermodynamic quantities 
  at the Murnaghan minimum.
11) Phonon dispersions at several geometries and calculation of the
   anharmonic vibrational properties: lattice parameter, bulk modulus,
   pressure derivative of the bulk modulus as a function of temperature.
   Thermal expansion as a function of temperature.
   Isobaric molar heat capacity as a function of temperature.
   Isoentropic bulk modulus as a function of temperature.
   Average Gruneisen parameter as a function of temperature.

The input of thermo_pw in the file thermo_control is in the form:

 &INPUT_THERMO
  what=' ',
  ... 
 /

where the possible values of what are:

scf           : a single scf calculation to determine the total energy.
scf_ke        : test of the dependence of the energy on the wavefunctions
                and density kinetic energy cut-off.
scf_nk        : test of the dependence of the energy on the k point sampling
                and on smearing.  
scf_bands     : a band structure calculation after an scf calculation.
scf_ph        : a phonon at a single q after a scf run.
scf_disp      : a phonon dispersion calculation after a scf run.
                This option calculates also the vibrational energy, free energy,
                entropy, and constant volume specific heat after the phonon 
                calculation.
mur_lc        : equilibrium lattice constant via murnaghan equation.
mur_lc_bands  : a band structure calculation at the minimum or the
                murnaghan.
mur_lc_ph     : a phonon calculation at a single q at the minimum of the 
                murnaghan.
mur_lc_disp   : a dispersion calculation at the minimum of the murnaghan  
                and the harmonic thermodynamical quantities.
mur_lc_t      : lattice constant and bulk modulus as a function of temperature 
                within the quasiharmonic approximation. Grunaisen parameters
                interpolated in the three central geometries and calculated
                at the T=0 equilibrium volume (keeping zero point effects
                into account).
  
The namelist INPUT_THERMO may contain the following variables:

what : one of the above strings that specifies the type of calculation.
       Mandatory.

ngeo : the number of geometries to use.
       Default: 1 for what=scf_*, 9  for what=mur_lc_*.
       The lattice constant of these geometries is calculated from the
       input of pw.x. The celldm(1) of this input is used in the central 
       geometries. For the others celldm(1) is changed in steps of step_ngeo.

step_ngeo : The step between the lattice constant at different geometries.
       Default: 0.05 a.u.

emin_input : minimum energy for the band dispersion plot
             Default: determined from the bands
emax_input : maximum energy for the band dispersion plot
             (these ranges are with respect to the shifted bands)
             In metals the Fermi level is at zero, in insulator the
             last valence band of the first k point.
             Default: determined from the bands
nbnd_bands : the number of bands in the band calculation
             Default: nbnd given in pw input.

vmin_input : minimum volume for Murnaghan plot
             Default: 0.98 times the volume of the first geometry
vmax_input : maximum volume for Murnaghan plot
             Default: 1.02 times the volume of the last geometry
deltav     : distance between two volumes in Murnaghan plot
             Default: calculated from nvol
nvol       : number of volumes in Murnaghan plot
             Default : 51


nke        : number of kinetic energies tested in the wavefunctions
             kinetic energy test.
             Default: 5
deltake    : delta of wavefunctions kinetic energy in Ry.
             Default: 10 Ry
nkeden     : number of kinetic energies tested in the charge density
             kinetic energy test.
             Default: 1
deltakeden : delta of density kinetic energy.
             Default: 100

nnk        : the number of different nk to test
             Default: 5
deltank    : the step in nk
             Default: 2
nsigma     : the number of intervals of smearing
             Default: 1 (no test)
deltasigma : the distance between different smearing values.
             Default: 0.005 Ry

tmin    : minimum temperature
          Default: 1 K
tmax    : maximum temperature
          Default: 800 K
deltat  : interval between two temperatures
          Default: 3 K
ntemp   : number of temperatures
          Default: determined from previous data

freqmin : minimum frequency for phonon dos plot
          Default: determined from phonon
freqmax : maximum frequency for phonon dos plot
          Default: determined from phonon
deltafreq : frequency interval for phonon dos plot
          Default: 1 cm^{-1}
ndos    : number of dos points in the frequency interval
          Default: determined from previous data
nq1_d, nq2_d, nq3_d : thick mesh for phonon dos calculation
          Default: 16, 16, 16
zasr : type of acoustic sum rule applied to the ifc
          Default: 'Simple'


filband   : file where electronic bands and representations are written
            Default: output_band.dat
flpband   : file where plottable electronic bands are written
            Default: output_pband.dat
flfrc     : file where the interatomic force constants are written
            Default: output_frc.dat
flfrq     : file where matdyn writes the interpolated frequencies 
            Default: output_frq.dat
fldos     : file where the phonon dos is written
            Default: output_dos.dat
fltherm   : file where the harmonic thermodynamic quantities are written
            Default: output_therm.dat
flanhar   : file where the anharmonic thermodynamic quantities are written
            Default: output_anhar.dat
flevdat   : file where the murneghan equation is written
            Default: output_ev.dat
flkeconv  : file where the data with the kinetic energy convergence is written
            Default: output_keconv.dat
flnkconv  : file where the data with the k point convergence is written
            Default: 'output_nkconv.dat'

flgnuplot : name of the files where gnuplot scripts are written
            Default: gnuplot.tmp
flpsmur   : postscript file of the Murnaghan plot
            Default: output_mur.ps
flpsband  : postscript file of the electronic band structure
            Default: output_band.ps
flpsdisp  : postscript file of the phonon dispersions
            Default: output_disp.ps
flpsdos   : postscript file of the phonon dos
            Default: output_dos.ps
flpstherm : postscript file of the harmonic thermodynamic quantities
            Default: output_therm.ps
flpsanhar : postscript file of the anharmonic quantities
            Default: output_anhar.ps
flpskeconv : postscript file with the kinetic energy convergence
            Default: output_keconv.ps
flpsnkconv : postscript file with the k points convergence
            Default: output_nkconv.ps


q2d              : the q or k vectors are specified in a plane
                 Default: .FALSE.
q_in_band_form   : the q or k are given along paths
                 Default: .TRUE.
q_in_cryst_coord : the q or k are given in crystal coordinates
                 Default: .FALSE.
point_label_type : the label definition (see the BZ manual)
                 Default: SC

lgnuplot         : if .TRUE. gnuplot is called from within the program
                 and the postscript files are immediately available
                 Default: .TRUE.
gnuplot_command  : the command used to call gnuplot.
                 Default: gnuplot
